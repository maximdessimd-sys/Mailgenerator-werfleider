<!DOCTYPE html>
<html lang="nl-BE">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactief Dashboard: Bouwproject X</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            background-color: #f5f5f4; 
            color: #292524;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .zone-btn {
            transition: all 0.2s ease;
        }
        .zone-btn.active {
            background-color: #ea580c; 
            color: white;
            border-color: #ea580c;
            transform: translateX(4px);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .mail-item {
            border-left: 4px solid transparent;
        }
        .mail-item.active {
            border-left-color: #ea580c;
            background-color: #fffaf8;
        }
        .mail-item.unread {
            background-color: #ffffff;
            font-weight: 700;
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 10px; }
        
        #reply-text {
            scroll-margin-bottom: 100px;
        }
        .email-body {
            white-space: pre-wrap;
            line-height: 1.6;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <header class="bg-stone-900 text-stone-100 py-4 shadow-md border-b-4 border-orange-600">
        <div class="max-w-6xl mx-auto px-4 flex flex-col sm:flex-row justify-between items-center gap-2">
            <div>
                <h1 class="text-2xl font-bold tracking-tight text-white">Bouwproject X</h1>
                <p class="text-stone-400 text-sm">Werfcommunicatie Portaal</p>
            </div>
            <div class="bg-stone-800 px-3 py-1 rounded border border-stone-700 flex items-center gap-2 text-orange-500">
                <span id="current-date" class="text-sm font-bold tracking-widest uppercase">28 Feb 2026</span>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-6xl mx-auto px-4 py-6 w-full flex flex-col gap-6">

        <!-- Statistieken -->
        <section class="grid grid-cols-1 sm:grid-cols-4 gap-4">
            <div class="bg-white rounded-xl shadow-sm p-4 border border-stone-200">
                <p class="text-[10px] text-stone-500 uppercase font-bold tracking-wider mb-1">Status Project</p>
                <div class="flex items-center gap-2">
                    <span class="text-2xl font-black text-orange-600">68%</span>
                    <div class="flex-grow bg-stone-100 h-1.5 rounded-full overflow-hidden">
                        <div class="bg-orange-600 h-full w-[68%]"></div>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 border border-stone-200">
                <p class="text-[10px] text-stone-500 uppercase font-bold tracking-wider mb-1">Ongelezen</p>
                <p id="unread-count" class="text-2xl font-black text-blue-600">3</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 border border-stone-200">
                <p class="text-[10px] text-stone-500 uppercase font-bold tracking-wider mb-1">Veiligheid</p>
                <p class="text-2xl font-black text-green-600">A+</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-4 border border-stone-200">
                <p class="text-[10px] text-stone-500 uppercase font-bold tracking-wider mb-1">Dagen tot deadline</p>
                <p class="text-2xl font-black text-stone-800">46</p>
            </div>
        </section>

        <!-- Mail Layout Inbox -->
        <section class="bg-white rounded-2xl shadow-xl border border-stone-200 overflow-hidden flex flex-col h-[700px]">
            <div class="bg-stone-100 border-b border-stone-200 p-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center text-white font-bold shadow-sm">In</div>
                    <h2 class="text-sm font-bold text-stone-800 uppercase tracking-widest">Werf Inbox</h2>
                </div>
                <div id="ai-status" class="invisible flex items-center gap-2 text-[10px] font-bold text-orange-600 animate-pulse">
                    <span class="w-2 h-2 bg-orange-600 rounded-full"></span> AI IS EAN HET ANTWOORDEN...
                </div>
            </div>
            
            <div class="flex flex-grow overflow-hidden">
                <!-- Mail Lijst -->
                <div id="mail-list" class="w-1/3 border-r border-stone-200 overflow-y-auto bg-stone-50">
                </div>

                <!-- Mail Detail -->
                <div id="mail-detail" class="w-2/3 flex flex-col bg-white overflow-y-auto relative">
                    <div class="p-16 text-center text-stone-400 h-full flex flex-col justify-center">
                        <div class="w-20 h-20 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-10 h-10 text-stone-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
                        </div>
                        <p class="font-medium text-stone-600">Selecteer een bericht</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Werfzones -->
        <section class="bg-white rounded-2xl shadow-sm p-6 border border-stone-200">
            <h2 class="text-sm font-bold mb-6 text-stone-400 uppercase tracking-widest">Live Werfzones Update</h2>
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="lg:w-1/4 flex flex-col gap-3">
                    <button class="zone-btn active bg-white border border-stone-200 text-stone-700 text-sm font-bold py-4 px-5 rounded-xl text-left flex justify-between items-center shadow-sm" onclick="showZone('ruwbouw', this)">
                        <span>RUWBOUW</span><span class="text-orange-500 italic">85%</span>
                    </button>
                    <button class="zone-btn bg-white border border-stone-200 text-stone-700 text-sm font-bold py-4 px-5 rounded-xl text-left flex justify-between items-center shadow-sm" onclick="showZone('techniek', this)">
                        <span>TECHNIEKEN</span><span class="text-blue-500 italic">40%</span>
                    </button>
                    <button class="zone-btn bg-white border border-stone-200 text-stone-700 text-sm font-bold py-4 px-5 rounded-xl text-left flex justify-between items-center shadow-sm" onclick="showZone('veiligheid', this)">
                        <span>VEILIGHEID</span><span class="text-green-500 italic">OK</span>
                    </button>
                    <button class="zone-btn bg-white border border-stone-200 text-stone-700 text-sm font-bold py-4 px-5 rounded-xl text-left flex justify-between items-center shadow-sm" onclick="showZone('planning', this)">
                        <span>PLANNING</span><span class="text-stone-500 italic">W12</span>
                    </button>
                </div>
                <div id="zone-content" class="lg:w-3/4 bg-stone-50 rounded-2xl p-8 border border-stone-200 min-h-[250px]"></div>
            </div>
        </section>
    </main>

    <script>
        const apiKey = ""; 

        let messages = [
            { 
                id: 1, 
                sender: "Dakwerken Peeters", 
                email: "info@peeters-dak.be", 
                subject: "Lek ontdekt Volume 2", 
                date: "Vandaag, 14:22", 
                body: "Beste werfleider,\n\nWe hebben een probleem bij Volume 2. Door de wind is er een tijdelijke dichting losgekomen. Er is waterinfiltratie.\n\nKunnen we morgenochtend extra ploegen inzetten voor herstel?\n\nMet vriendelijke groeten,\n\nMarc Peeters", 
                unread: true, 
                thread: [] 
            },
            { 
                id: 2, 
                sender: "Holcim Beton", 
                email: "planning@holcim.be", 
                subject: "Vertraging levering Maandag", 
                date: "Vandaag, 09:15", 
                body: "Geachte,\n\nWegens een technische storing in onze centrale Grimbergen zal de levering van maandag vertraagd zijn. We verwachten pas rond 11:30 op de werf te zijn.\n\nIs dit akkoord voor jullie planning?\n\nMet vriendelijke groeten,\n\nDe Planning", 
                unread: true, 
                thread: [] 
            },
            { 
                id: 3, 
                sender: "Janssens Elektro", 
                email: "p.janssens@elektro-j.be", 
                subject: "Kabelgoten +2 gereed", 
                date: "Gisteren, 16:45", 
                body: "Beste,\n\nDe kabelgoten op verdieping +2 zijn volledig geplaatst volgens plan. U kunt de keuringsinstantie inlichten voor de tussenkomst van volgende week.\n\nMet vriendelijke groeten,\n\nPieter Janssens", 
                unread: false, 
                thread: [] 
            }
        ];

        async function callGemini(prompt, senderName) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const systemPrompt = `Je bent ${senderName}, werkzaam bij Bouwproject X.
            De gebruiker is de werfleider. 
            Reageer professioneel en gebruik ALTIJD de volgende e-mailstructuur:
            
            Beste [Naam/Werfleider],
            
            [Inhoud van je bericht met duidelijke alinea's]
            
            Met vriendelijke groeten,
            
            ${senderName}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            const maxRetries = 3;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) throw new Error('API request failed');
                    
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) return text;
                    throw new Error('No text in response');
                } catch (error) {
                    if (i === maxRetries - 1) return `Beste werfleider,\n\nBedankt voor uw bericht. Wij hebben dit genoteerd en zullen de nodige acties ondernemen.\n\nMet vriendelijke groeten,\n\n${senderName}`;
                    await new Promise(r => setTimeout(r, 1000 * Math.pow(2, i)));
                }
            }
        }

        function renderMailList() {
            const list = document.getElementById('mail-list');
            const unreadDisplay = document.getElementById('unread-count');
            let unreadCount = 0;
            
            list.innerHTML = messages.map(m => {
                if(m.unread) unreadCount++;
                return `
                <div onclick="openMail(${m.id})" class="mail-item p-4 border-b border-stone-200 cursor-pointer hover:bg-white transition-all ${m.unread ? 'unread' : ''}" id="mail-item-${m.id}">
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-sm text-stone-800 truncate pr-2">${m.sender}</span>
                        <span class="text-[10px] text-stone-400 whitespace-nowrap">${m.date.split(',')[1] || m.date}</span>
                    </div>
                    <div class="text-xs text-orange-600 font-bold truncate mb-1">${m.subject}</div>
                    <div class="text-[11px] text-stone-400 truncate">${m.body.split('\n')[2] || m.body.substring(0, 30)}...</div>
                </div>`;
            }).join('');
            unreadDisplay.innerText = unreadCount;
        }

        function openMail(id) {
            const mail = messages.find(m => m.id === id);
            mail.unread = false;
            renderMailList();
            
            document.querySelectorAll('.mail-item').forEach(el => el.classList.remove('active'));
            const activeItem = document.getElementById(`mail-item-${id}`);
            if (activeItem) activeItem.classList.add('active');

            const threadHtml = mail.thread.map(t => `
                <div class="mb-8 ${t.role === 'user' ? 'ml-12' : 'mr-12'} fade-in">
                    <div class="text-[10px] font-bold text-stone-400 uppercase mb-2 flex items-center gap-2">
                        ${t.role === 'user' ? '<span>U (WERFLEIDER)</span>' : '<span>' + mail.sender.toUpperCase() + '</span>'}
                        <div class="h-px flex-grow bg-stone-100"></div>
                    </div>
                    <div class="${t.role === 'user' ? 'bg-orange-50 border-orange-100' : 'bg-stone-50 border-stone-100'} p-5 rounded-2xl border text-sm shadow-sm email-body">${t.text}</div>
                </div>
            `).join('');

            document.getElementById('mail-detail').innerHTML = `
                <div class="p-8 flex flex-col h-full bg-white">
                    <div class="border-b border-stone-100 pb-6 mb-8 flex justify-between items-start">
                        <div>
                            <h3 class="text-xl font-bold text-stone-800 tracking-tight mb-2">${mail.subject}</h3>
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 bg-stone-100 text-stone-600 rounded-full flex items-center justify-center text-xs font-black uppercase">${mail.sender[0]}</div>
                                <div class="flex flex-col">
                                    <span class="text-sm font-bold text-stone-800">${mail.sender}</span>
                                    <span class="text-[11px] text-stone-400 font-medium">${mail.email}</span>
                                </div>
                            </div>
                        </div>
                        <span class="text-[10px] font-bold text-stone-300 uppercase">${mail.date}</span>
                    </div>
                    
                    <div id="thread-container" class="flex-grow overflow-y-auto pr-4 mb-6">
                        <div class="mb-8 mr-12">
                            <div class="text-[10px] font-bold text-stone-400 uppercase mb-2 flex items-center gap-2">
                                <span>${mail.sender.toUpperCase()}</span>
                                <div class="h-px flex-grow bg-stone-100"></div>
                            </div>
                            <div class="bg-stone-50 border border-stone-100 p-5 rounded-2xl text-sm shadow-sm email-body">${mail.body}</div>
                        </div>
                        ${threadHtml}
                    </div>

                    <div class="border-t border-stone-100 pt-6">
                        <div class="relative">
                            <textarea id="reply-text" 
                                class="w-full h-32 p-5 border-2 border-stone-100 rounded-3xl text-sm focus:border-orange-500 focus:ring-0 outline-none transition-all resize-none shadow-inner" 
                                placeholder="Typ uw antwoord... (Gebruik 'Beste, ... Met vriendelijke groeten, ...')"
                                onfocus="scrollToBottom()"></textarea>
                            <button onclick="sendReply(${id})" 
                                class="absolute bottom-4 right-4 bg-stone-900 text-white text-[10px] font-black uppercase tracking-widest px-6 py-3 rounded-2xl hover:bg-orange-600 active:scale-95 transition-all shadow-lg">
                                Verzenden
                            </button>
                        </div>
                    </div>
                </div>
            `;
            scrollToBottom();
        }

        function scrollToBottom() {
            setTimeout(() => {
                const container = document.getElementById('thread-container');
                if (container) container.scrollTop = container.scrollHeight;
            }, 100);
        }

        async function sendReply(id) {
            const textarea = document.getElementById('reply-text');
            const text = textarea.value.trim();
            if(!text) return;

            const mail = messages.find(m => m.id === id);
            mail.thread.push({ role: 'user', text: text });
            
            openMail(id);
            
            const statusEl = document.getElementById('ai-status');
            statusEl.classList.remove('invisible');
            
            const context = `Context: Bouwproject X.\nInkomend bericht: ${mail.body}\nThread:\n${mail.thread.map(t => `${t.role === 'user' ? 'Werfleider' : mail.sender}: ${t.text}`).join('\n')}\nSchrijf nu de reactie van ${mail.sender}.`;
            
            try {
                const aiReply = await callGemini(context, mail.sender);
                setTimeout(() => {
                    mail.thread.push({ role: 'ai', text: aiReply });
                    statusEl.classList.add('invisible');
                    openMail(id);
                }, 1000);
            } catch (err) {
                statusEl.classList.add('invisible');
            }
        }

        const zoneData = {
            ruwbouw: { title: "Ruwbouw", content: `<div class="fade-in space-y-4 text-sm text-stone-600"><p>Funderingswerken fase 2 voltooid. Start bekisting kolommen.</p><div class="bg-white p-4 rounded-xl border border-stone-100">Status: Conform planning.</div></div>` },
            techniek: { title: "Technieken", content: `<div class="fade-in space-y-4 text-sm text-stone-600"><p>Slijpwerken elektriciteit gestart op het gelijkvloers.</p><div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-blue-800">Aandacht: Co√∂rdinatie met sanitair vereist.</div></div>` },
            veiligheid: { title: "Veiligheid", content: `<div class="fade-in grid grid-cols-2 gap-4"><div class="bg-green-50 p-6 rounded-xl border border-green-200 text-center"><p class="text-[10px] font-bold text-green-700 uppercase">Ongevallen</p><p class="text-4xl font-black text-green-800">0</p></div><div class="bg-white p-6 rounded-xl border border-stone-200 text-center"><p class="text-[10px] font-bold text-stone-500 uppercase">VGM Score</p><p class="text-4xl font-black text-stone-800">92%</p></div></div>` },
            planning: { 
                title: "Planning & Deadlines", 
                content: `<div class="fade-in space-y-3">
                    <div class="flex items-center gap-4 p-4 bg-white rounded-xl border border-stone-100 shadow-sm">
                        <span class="w-10 h-10 rounded-lg bg-orange-100 text-orange-700 flex items-center justify-center font-black">W12</span>
                        <div class="flex flex-col">
                            <span class="text-sm font-bold">Start dakdichting Volume 3</span>
                            <span class="text-[10px] text-stone-400 uppercase font-bold tracking-tight">Kritiek Pad</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 p-4 bg-blue-50 rounded-xl border border-blue-100 shadow-sm">
                        <span class="w-10 h-10 rounded-lg bg-blue-100 text-blue-700 flex items-center justify-center font-black">W14</span>
                        <div class="flex flex-col">
                            <span class="text-sm font-bold">Levering Warmtepompen</span>
                            <span class="text-[10px] text-blue-400 uppercase font-bold tracking-tight">Vertraging van 2 weken</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 p-4 bg-white rounded-xl border border-stone-100 shadow-sm opacity-50">
                        <span class="w-10 h-10 rounded-lg bg-stone-100 text-stone-500 flex items-center justify-center font-black">JUN</span>
                        <div class="flex flex-col">
                            <span class="text-sm font-bold">Mijlpaal: Wind- en waterdicht</span>
                            <span class="text-[10px] text-stone-400 uppercase font-bold tracking-tight">Deadline 2026</span>
                        </div>
                    </div>
                </div>` 
            }
        };

        function showZone(key, btn) {
            document.querySelectorAll('.zone-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const data = zoneData[key];
            document.getElementById('zone-content').innerHTML = `
                <h3 class="text-lg font-black text-stone-800 mb-6 tracking-tight flex items-center gap-2">
                    <span class="w-1.5 h-6 bg-orange-600 rounded-full"></span>
                    ${data.title}
                </h3>
                ${data.content}
            `;
        }

        window.onload = () => {
            renderMailList();
            showZone('ruwbouw', document.querySelector('.zone-btn'));
        };
    </script>
</body>
</html>
